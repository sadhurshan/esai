RFQ Clarifications, Amendments & Deadline Management

Status snapshot (2025-11-25)

1. ✅ **Clarification thread per RFQ** – `routes/api.php` wires `/api/rfqs/{rfq}/clarifications/*` into `RfqClarificationController`, which enforces policy checks and funnels through `RfqClarificationService` for Q&A storage, attachment handling, and `NotificationService` fan-out (`rfq.clarification.*`). The SPA consumes the same endpoints via `useRfqClarifications` + `ClarificationThread`, giving suppliers a live thread per RFQ.
2. ✅ **Amendments versioning & audit** – Buyer-only `postAmendment` marks `version_increment=true`, bumps `rfq_version`/`current_revision_id`, and emits `AuditLogger` entries before notifying suppliers (`app/Services/RfqClarificationService.php`). `tests/Feature/Api/RfqClarificationControllerTest.php` covers version bumping and notifications; the UI’s `useAmendRfq` mutation reuses this API so nothing is client-only.
3. ✅ **Deadline extensions** – `rfq_deadline_extensions` migration + model capture previous/new deadlines, reasons, and actors, `RfqDeadlineExtensionService` enforces status/chronology rules, updates `due_at`/`close_at`, fires `AuditLogger`, and fan-outs the new `rfq.deadline.extended` notification via `NotificationService`. `RFQController@extendDeadline` exposes `POST /api/rfqs/{rfq}/extend-deadline` with `ExtendRfqDeadlineRequest`, and `RfqDeadlineExtensionResource` + `tests/Feature/Api/RfqDeadlineExtensionTest.php` cover success, validation, and closed-RFQ rejections.
4. ✅ **Deadline-based locking** – Added `RfqResponseWindowGuard` and wired it into `RfqClarificationController`, `QuoteController`, and `QuoteDraftService`, plus `QuoteLineController` error handling, so clarifications, quote drafts, submissions, and line edits all fail with a 409 once an RFQ leaves `open` or the `due_at`/`close_at` timestamp has passed. Tests covering clarifications and quote drafts (`RfqClarificationControllerTest`, `QuoteSubmissionTest`) now assert the guard behavior.
5. ✅ **Server-side transition logging** – Clarifications/amendments are stored tenant-scoped, soft-deleted, and wrapped in DB transactions with `AuditLogger` calls plus document metadata captures, so timelines stay accurate even if the UI is bypassed. Notifications are raised server-side, so email/in-app delivery isn’t reliant on client state.
6. ✅ **Deadline extension UI wiring** – RFQ detail page now exposes an “Extend deadline” dialog powered by `useExtendRfqDeadline`, enforcing later-date + reason validation, optional supplier notifications, and automatic detail/timeline refreshes. Timeline view formats the new `deadline_extended` entries with previous/new deadlines and the buyer-supplied rationale so both sides see the audit trail.