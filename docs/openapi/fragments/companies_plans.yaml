components:
    schemas:
        CompanyProfile:
            type: object
            required:
                - id
                - name
                - status
            properties:
                id:
                    type: integer
                name:
                    type: string
                slug:
                    type: string
                status:
                    type: string
                    description: Buyer account status (pending, active, suspended, archived).
                supplier_status:
                    type: string
                    nullable: true
                email_domain:
                    type: string
                    nullable: true
                primary_contact_name:
                    type: string
                    nullable: true
                primary_contact_email:
                    type: string
                    format: email
                    nullable: true
                country:
                    type: string
                    nullable: true
                website:
                    type: string
                    format: uri
                    nullable: true
                has_completed_onboarding:
                    type: boolean
                created_at:
                    type: string
                    format: date-time
                updated_at:
                    type: string
                    format: date-time
        Plan:
            type: object
            required:
                - id
                - code
                - name
                - price_usd
            properties:
                id:
                    type: integer
                code:
                    type: string
                name:
                    type: string
                price_usd:
                    type: number
                    format: float
                rfqs_per_month:
                    type: integer
                    nullable: true
                users_max:
                    type: integer
                    nullable: true
                analytics_enabled:
                    type: boolean
                inventory_enabled:
                    type: boolean
                multi_currency_enabled:
                    type: boolean
                tax_engine_enabled:
                    type: boolean
                localization_enabled:
                    type: boolean
                exports_enabled:
                    type: boolean
                created_at:
                    type: string
                    format: date-time
                updated_at:
                    type: string
                    format: date-time
        PlanCatalogEntry:
            type: object
            required:
                - code
                - name
                - analytics_enabled
                - exports_enabled
                - localization_enabled
                - multi_currency_enabled
                - tax_engine_enabled
                - is_free
            properties:
                code:
                    type: string
                name:
                    type: string
                price_usd:
                    type: number
                    format: float
                    nullable: true
                rfqs_per_month:
                    type: integer
                    nullable: true
                invoices_per_month:
                    type: integer
                    nullable: true
                users_max:
                    type: integer
                    nullable: true
                storage_gb:
                    type: integer
                    nullable: true
                erp_integrations_max:
                    type: integer
                    nullable: true
                analytics_enabled:
                    type: boolean
                analytics_history_months:
                    type: integer
                    nullable: true
                risk_scores_enabled:
                    type: boolean
                risk_history_months:
                    type: integer
                    nullable: true
                approvals_enabled:
                    type: boolean
                approval_levels_limit:
                    type: integer
                    nullable: true
                rma_enabled:
                    type: boolean
                rma_monthly_limit:
                    type: integer
                    nullable: true
                credit_notes_enabled:
                    type: boolean
                global_search_enabled:
                    type: boolean
                quote_revisions_enabled:
                    type: boolean
                digital_twin_enabled:
                    type: boolean
                maintenance_enabled:
                    type: boolean
                inventory_enabled:
                    type: boolean
                inventory_history_months:
                    type: integer
                    nullable: true
                pr_enabled:
                    type: boolean
                multi_currency_enabled:
                    type: boolean
                tax_engine_enabled:
                    type: boolean
                localization_enabled:
                    type: boolean
                exports_enabled:
                    type: boolean
                export_row_limit:
                    type: integer
                    nullable: true
                data_export_enabled:
                    type: boolean
                export_history_days:
                    type: integer
                    nullable: true
                is_free:
                    type: boolean
        PlanSelectionResult:
            type: object
            required:
                - company
                - plan
            properties:
                company:
                    type: object
                    required:
                        - id
                        - plan
                        - billing_status
                        - requires_plan_selection
                    properties:
                        id:
                            type: integer
                        plan:
                            type: string
                            nullable: true
                        billing_status:
                            type: string
                        requires_plan_selection:
                            type: boolean
                plan:
                    $ref: '#/components/schemas/PlanCatalogEntry'
        PlanCheckoutResult:
            type: object
            required:
                - requires_checkout
            properties:
                requires_checkout:
                    type: boolean
                plan:
                    type: string
                    nullable: true
                    description: Present when the selected plan does not require an external checkout session.
                checkout:
                    type: object
                    nullable: true
                    properties:
                        provider:
                            type: string
                        session_id:
                            type: string
                            nullable: true
                        checkout_url:
                            type: string
                            format: uri
                            nullable: true
                        status:
                            type: string
                            nullable: true
        BillingPortalSession:
            type: object
            required:
                - portal
            properties:
                portal:
                    type: object
                    required:
                        - provider
                        - url
                    properties:
                        provider:
                            type: string
                        url:
                            type: string
                            format: uri
        BillingInvoice:
            type: object
            properties:
                id:
                    type: string
                    nullable: true
                number:
                    type: string
                    nullable: true
                status:
                    type: string
                    nullable: true
                currency:
                    type: string
                    nullable: true
                amount_due:
                    type: integer
                    nullable: true
                    description: Minor units owed on the invoice.
                amount_paid:
                    type: integer
                    nullable: true
                amount_remaining:
                    type: integer
                    nullable: true
                total:
                    type: integer
                    nullable: true
                hosted_invoice_url:
                    type: string
                    format: uri
                    nullable: true
                invoice_pdf:
                    type: string
                    format: uri
                    nullable: true
                created_at:
                    type: string
                    format: date-time
                    nullable: true
                due_at:
                    type: string
                    format: date-time
                    nullable: true
                period_start:
                    type: string
                    format: date-time
                    nullable: true
                period_end:
                    type: string
                    format: date-time
                    nullable: true
                collection_method:
                    type: string
                    nullable: true
                attempt_count:
                    type: integer
                    nullable: true
                next_payment_attempt_at:
                    type: string
                    format: date-time
                    nullable: true
                is_paid:
                    type: boolean
                    nullable: true
                is_attempting_collection:
                    type: boolean
                    nullable: true
        FeatureFlag:
            type: object
            required:
                - id
                - company_id
                - key
                - value
            properties:
                id:
                    type: integer
                company_id:
                    type: integer
                key:
                    type: string
                value:
                    type: boolean
                created_at:
                    type: string
                    format: date-time
                updated_at:
                    type: string
                    format: date-time
        CompanyInvitation:
            type: object
            required:
                - id
                - email
                - role
                - status
                - company_id
            properties:
                id:
                    type: integer
                email:
                    type: string
                    format: email
                role:
                    type: string
                status:
                    type: string
                    description: Invitation lifecycle state (pending, accepted, revoked, expired).
                expires_at:
                    type: string
                    format: date-time
                    nullable: true
                accepted_at:
                    type: string
                    format: date-time
                    nullable: true
                revoked_at:
                    type: string
                    format: date-time
                    nullable: true
                invited_by:
                    type: integer
                    nullable: true
                company_id:
                    type: integer
                message:
                    type: string
                    nullable: true
                created_at:
                    type: string
                    format: date-time
        CompanyMember:
            type: object
            required:
                - id
                - name
                - email
                - role
                - membership
                - role_conflict
            properties:
                id:
                    type: integer
                name:
                    type: string
                email:
                    type: string
                    format: email
                role:
                    type: string
                job_title:
                    type: string
                    nullable: true
                phone:
                    type: string
                    nullable: true
                avatar_url:
                    type: string
                    format: uri
                    nullable: true
                last_login_at:
                    type: string
                    format: date-time
                    nullable: true
                is_active_company:
                    type: boolean
                membership:
                    type: object
                    properties:
                        id:
                            type: integer
                            nullable: true
                        company_id:
                            type: integer
                            nullable: true
                        is_default:
                            type: boolean
                        last_used_at:
                            type: string
                            format: date-time
                            nullable: true
                        created_at:
                            type: string
                            format: date-time
                            nullable: true
                        updated_at:
                            type: string
                            format: date-time
                            nullable: true
                role_conflict:
                    type: object
                    properties:
                        total_companies:
                            type: integer
                        distinct_roles:
                            type: array
                            items:
                                type: string
                        buyer_supplier_conflict:
                            type: boolean
                        has_conflict:
                            type: boolean
        RoleTemplate:
            type: object
            required:
                - id
                - slug
                - name
                - permissions
            properties:
                id:
                    type: string
                slug:
                    type: string
                name:
                    type: string
                description:
                    type: string
                    nullable: true
                permissions:
                    type: array
                    items:
                        type: string
                is_system:
                    type: boolean
        CompanyRoleTemplateCatalog:
            type: object
            required:
                - roles
                - permission_groups
            properties:
                roles:
                    type: array
                    items:
                        $ref: '#/components/schemas/RoleTemplate'
                permission_groups:
                    type: object
                    additionalProperties:
                        type: array
                        items:
                            type: string
        UserProfile:
            type: object
            required:
                - id
                - name
                - email
                - role
            properties:
                id:
                    type: integer
                name:
                    type: string
                email:
                    type: string
                    format: email
                role:
                    type: string
                company_id:
                    type: integer
                    nullable: true
                job_title:
                    type: string
                    nullable: true
                phone:
                    type: string
                    nullable: true
                locale:
                    type: string
                    nullable: true
                timezone:
                    type: string
                    nullable: true
                avatar_url:
                    type: string
                    format: uri
                    nullable: true
                avatar_path:
                    type: string
                    nullable: true
                email_verified_at:
                    type: string
                    format: date-time
                    nullable: true
                created_at:
                    type: string
                    format: date-time
                    nullable: true
                updated_at:
                    type: string
                    format: date-time
                    nullable: true
        UserCompany:
            type: object
            required:
                - id
                - name
                - status
                - role
                - is_default
                - is_active
            properties:
                id:
                    type: integer
                name:
                    type: string
                status:
                    type: string
                supplier_status:
                    type: string
                    nullable: true
                role:
                    type: string
                    nullable: true
                is_default:
                    type: boolean
                is_active:
                    type: boolean
        ApiKey:
            type: object
            required:
                - id
                - company_id
                - name
                - token_prefix
            properties:
                id:
                    type: integer
                company_id:
                    type: integer
                owner_user_id:
                    type: integer
                    nullable: true
                name:
                    type: string
                token_prefix:
                    type: string
                    description: First six characters of the secret for display.
                scopes:
                    type: array
                    items:
                        type: string
                active:
                    type: boolean
                last_used_at:
                    type: string
                    format: date-time
                    nullable: true
                expires_at:
                    type: string
                    format: date-time
                    nullable: true
                created_at:
                    type: string
                    format: date-time
                updated_at:
                    type: string
                    format: date-time
        RateLimitRule:
            type: object
            required:
                - id
                - scope
                - window_seconds
                - max_requests
            properties:
                id:
                    type: integer
                company_id:
                    type: integer
                    nullable: true
                scope:
                    type: string
                    description: Logical grouping (e.g. `tenant`, `api_key`).
                window_seconds:
                    type: integer
                max_requests:
                    type: integer
                active:
                    type: boolean
                created_at:
                    type: string
                    format: date-time
                updated_at:
                    type: string
                    format: date-time
paths:
    /api/plans:
        get:
            tags:
                - Companies
            summary: List publicly available subscription plans
            operationId: listPlansCatalog
            responses:
                '200':
                    description: Catalog of buyer subscription plans.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/PlanCatalogEntry'
    /api/company/plan-selection:
        post:
            tags:
                - Companies
            summary: Select a subscription plan for the authenticated company
            operationId: selectCompanyPlan
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - plan_code
                            properties:
                                plan_code:
                                    type: string
            responses:
                '200':
                    description: Plan selection saved for the tenant.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/PlanSelectionResult'
                '422':
                    $ref: '#/components/responses/ValidationError'
    /api/billing/checkout:
        post:
            tags:
                - Billing
            summary: Start a checkout session for paid subscription plans
            operationId: startPlanCheckout
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - plan_code
                            properties:
                                plan_code:
                                    type: string
                                    description: Plan code returned by the plan catalog endpoint.
            responses:
                '200':
                    description: Checkout session metadata or confirmation that checkout is unnecessary.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/PlanCheckoutResult'
                '404':
                    $ref: '#/components/responses/NotFound'
                '422':
                    $ref: '#/components/responses/ValidationError'
    /api/billing/portal:
        post:
            tags:
                - Billing
            summary: Create a Stripe billing portal session for the authenticated company
            operationId: createBillingPortalSession
            responses:
                '200':
                    description: Billing portal session created successfully.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/BillingPortalSession'
                '502':
                    description: Stripe billing portal is unavailable.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiErrorResponse'
    /api/billing/invoices:
        get:
            tags:
                - Billing
            summary: List recent billing invoices for the authenticated company
            operationId: listBillingInvoices
            responses:
                '200':
                    description: Stripe invoice history limited by configuration.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/BillingInvoice'
                '502':
                    description: Stripe invoice service is unavailable.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiErrorResponse'
    /api/company-members:
        get:
            tags:
                - Companies
            summary: List members for the authenticated company
            operationId: listCompanyMembers
            parameters:
                - $ref: '#/components/parameters/PerPageQuery'
                - $ref: '#/components/parameters/CursorQuery'
            responses:
                '200':
                    description: Company members collection.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/CompanyMember'
    /api/company-members/{member}:
        parameters:
            - name: member
              in: path
              required: true
              schema:
                  type: integer
        patch:
            tags:
                - Companies
            summary: Update a member's role within the company
            operationId: updateCompanyMember
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - role
                            properties:
                                role:
                                    type: string
                                    description: Must be one of owner, buyer_admin, buyer_member, buyer_requester, supplier_admin, supplier_estimator, finance.
            responses:
                '200':
                    description: Member updated.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/CompanyMember'
        delete:
            tags:
                - Companies
            summary: Remove a member from the company
            operationId: deleteCompanyMember
            responses:
                '200':
                    description: Member removed.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/company-role-templates:
        get:
            tags:
                - Companies
            summary: Retrieve available role templates and permission group metadata
            operationId: listCompanyRoleTemplates
            responses:
                '200':
                    description: Role template catalog.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/CompanyRoleTemplateCatalog'
    /api/me/profile:
        get:
            tags:
                - Companies
            summary: Fetch the authenticated user's profile
            operationId: getCurrentProfile
            responses:
                '200':
                    description: Profile retrieved.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/UserProfile'
        patch:
            tags:
                - Companies
            summary: Update the authenticated user's profile
            operationId: updateCurrentProfile
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                name:
                                    type: string
                                email:
                                    type: string
                                    format: email
                                job_title:
                                    type: string
                                    nullable: true
                                phone:
                                    type: string
                                    nullable: true
                                locale:
                                    type: string
                                    nullable: true
                                timezone:
                                    type: string
                                    nullable: true
                                avatar_path:
                                    type: string
                                    nullable: true
            responses:
                '200':
                    description: Profile updated.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/UserProfile'
    /api/me/companies:
        get:
            tags:
                - Companies
            summary: List companies the current user belongs to
            operationId: listUserCompanies
            responses:
                '200':
                    description: Company memberships.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/UserCompany'
    /api/me/companies/switch:
        post:
            tags:
                - Companies
            summary: Switch the active company context for the authenticated user
            operationId: switchUserCompany
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - company_id
                            properties:
                                company_id:
                                    type: integer
            responses:
                '200':
                    description: Active company updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/companies:
        post:
            tags:
                - Companies
            summary: Register company and request onboarding
            operationId: registerCompany
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - name
                                - country
                                - primary_contact_name
                                - primary_contact_email
                            properties:
                                name:
                                    type: string
                                country:
                                    type: string
                                primary_contact_name:
                                    type: string
                                primary_contact_email:
                                    type: string
                                    format: email
                                primary_contact_phone:
                                    type: string
                                    nullable: true
                                website:
                                    type: string
                                    format: uri
                                    nullable: true
            responses:
                '201':
                    description: Company onboarding request accepted.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  company:
                                                      $ref: '#/components/schemas/CompanyProfile'
    /api/companies/current:
        get:
            tags:
                - Companies
            summary: Retrieve profile for authenticated company
            operationId: showCurrentCompany
            responses:
                '200':
                    description: Current tenant company profile.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  company:
                                                      $ref: '#/components/schemas/CompanyProfile'
        patch:
            tags:
                - Companies
            summary: Update profile for authenticated company
            operationId: updateCurrentCompany
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            additionalProperties: true
            responses:
                '200':
                    description: Current company updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/companies/{companyId}:
        parameters:
            - name: companyId
              in: path
              required: true
              schema:
                  type: integer
        get:
            tags:
                - Companies
            summary: Retrieve company profile
            operationId: showCompany
            responses:
                '200':
                    description: Company profile visible to the authenticated tenant.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  company:
                                                      $ref: '#/components/schemas/CompanyProfile'
        put:
            tags:
                - Companies
            summary: Update company profile
            operationId: updateCompany
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                name:
                                    type: string
                                registration_no:
                                    type: string
                                tax_id:
                                    type: string
                                country:
                                    type: string
                                email_domain:
                                    type: string
                                primary_contact_name:
                                    type: string
                                primary_contact_email:
                                    type: string
                                    format: email
                                primary_contact_phone:
                                    type: string
                                address:
                                    type: string
                                phone:
                                    type: string
                                website:
                                    type: string
                                    format: uri
                                region:
                                    type: string
            responses:
                '200':
                    description: Company profile updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/companies/{companyId}/documents:
        parameters:
            - name: companyId
              in: path
              required: true
              schema:
                  type: integer
        get:
            tags:
                - Companies
            summary: List company documents
            operationId: listCompanyDocuments
            responses:
                '200':
                    description: Documents associated with the company.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
        post:
            tags:
                - Companies
            summary: Upload company document
            operationId: createCompanyDocument
            requestBody:
                required: true
                content:
                    multipart/form-data:
                        schema:
                            type: object
                            required:
                                - file
                            properties:
                                file:
                                    type: string
                                    format: binary
                                label:
                                    type: string
            responses:
                '201':
                    description: Company document stored.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/companies/{companyId}/documents/{documentId}:
        parameters:
            - name: companyId
              in: path
              required: true
              schema:
                  type: integer
            - name: documentId
              in: path
              required: true
              schema:
                  type: integer
        delete:
            tags:
                - Companies
            summary: Delete company document
            operationId: deleteCompanyDocument
            responses:
                '200':
                    description: Company document removed.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/plans:
        get:
            tags:
                - Admin
            summary: List subscription plans
            operationId: adminPlansIndex
            responses:
                '200':
                    description: Paginated plans configured in the platform.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/Plan'
                                                  meta:
                                                      $ref: '#/components/schemas/PageMeta'
        post:
            tags:
                - Admin
            summary: Create subscription plan
            operationId: adminPlansStore
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - code
                                - name
                                - price_usd
                            properties:
                                code:
                                    type: string
                                name:
                                    type: string
                                price_usd:
                                    type: number
                                    format: float
                                rfqs_per_month:
                                    type: integer
                                    nullable: true
                                users_max:
                                    type: integer
                                    nullable: true
                                analytics_enabled:
                                    type: boolean
                                inventory_enabled:
                                    type: boolean
                                multi_currency_enabled:
                                    type: boolean
            responses:
                '201':
                    description: Plan created.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/plans/{planId}:
        parameters:
            - name: planId
              in: path
              required: true
              schema:
                  type: integer
        get:
            tags:
                - Admin
            summary: Retrieve subscription plan
            operationId: adminPlansShow
            responses:
                '200':
                    description: Subscription plan details.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/Plan'
        put:
            tags:
                - Admin
            summary: Update subscription plan
            operationId: adminPlansUpdate
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                name:
                                    type: string
                                price_usd:
                                    type: number
                                    format: float
                                analytics_enabled:
                                    type: boolean
                                inventory_enabled:
                                    type: boolean
                                multi_currency_enabled:
                                    type: boolean
            responses:
                '200':
                    description: Plan updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
        delete:
            tags:
                - Admin
            summary: Archive subscription plan
            operationId: adminPlansDestroy
            responses:
                '204':
                    description: Plan archived. Response body omitted.
    /api/admin/companies/{companyId}/assign-plan:
        post:
            tags:
                - Admin
            summary: Assign plan to company
            operationId: adminAssignPlan
            parameters:
                - name: companyId
                  in: path
                  required: true
                  schema:
                      type: integer
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - plan_id
                            properties:
                                plan_id:
                                    type: integer
                                trial_ends_at:
                                    type: string
                                    format: date-time
                                    nullable: true
                                seats_purchased:
                                    type: integer
                                    nullable: true
            responses:
                '202':
                    description: Plan assignment queued.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/companies/{companyId}/status:
        put:
            tags:
                - Admin
            summary: Update company lifecycle status
            operationId: adminUpdateCompanyStatus
            parameters:
                - name: companyId
                  in: path
                  required: true
                  schema:
                      type: integer
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - status
                            properties:
                                status:
                                    type: string
                                    enum: [pending, active, suspended, archived]
                                note:
                                    type: string
                                    nullable: true
            responses:
                '200':
                    description: Company status updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/companies/{companyId}/feature-flags:
        get:
            tags:
                - Admin
            summary: List company feature flags
            operationId: adminListFeatureFlags
            parameters:
                - name: companyId
                  in: path
                  required: true
                  schema:
                      type: integer
            responses:
                '200':
                    description: Collection of company-scoped feature toggles.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/FeatureFlag'
        post:
            tags:
                - Admin
            summary: Create feature flag override
            operationId: adminCreateFeatureFlag
            parameters:
                - name: companyId
                  in: path
                  required: true
                  schema:
                      type: integer
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - key
                                - value
                            properties:
                                key:
                                    type: string
                                value:
                                    type: boolean
            responses:
                '201':
                    description: Feature flag created.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/companies/{companyId}/feature-flags/{flagId}:
        parameters:
            - name: companyId
              in: path
              required: true
              schema:
                  type: integer
            - name: flagId
              in: path
              required: true
              schema:
                  type: integer
        put:
            tags:
                - Admin
            summary: Update feature flag override
            operationId: adminUpdateFeatureFlag
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                value:
                                    type: boolean
            responses:
                '200':
                    description: Feature flag updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
        delete:
            tags:
                - Admin
            summary: Remove feature flag override
            operationId: adminDeleteFeatureFlag
            responses:
                '200':
                    description: Feature flag removed.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/api-keys:
        get:
            tags:
                - Admin
            summary: List API keys
            operationId: adminListApiKeys
            parameters:
                - name: company_id
                  in: query
                  schema:
                      type: integer
            responses:
                '200':
                    description: Paginated API keys filtered by company when provided.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/ApiKey'
                                                  meta:
                                                      $ref: '#/components/schemas/PageMeta'
        post:
            tags:
                - Admin
            summary: Issue API key for company
            operationId: adminCreateApiKey
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - company_id
                                - name
                            properties:
                                company_id:
                                    type: integer
                                name:
                                    type: string
                                scopes:
                                    type: array
                                    items:
                                        type: string
                                expires_at:
                                    type: string
                                    format: date-time
                                    nullable: true
            responses:
                '201':
                    description: API key created. Plaintext secret returned once.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  api_key:
                                                      $ref: '#/components/schemas/ApiKey'
                                                  token:
                                                      type: string
                                                      description: Plaintext API key value. Display once.
    /api/admin/api-keys/{keyId}/rotate:
        post:
            tags:
                - Admin
            summary: Rotate API key secret
            operationId: adminRotateApiKey
            parameters:
                - name: keyId
                  in: path
                  required: true
                  schema:
                      type: integer
            responses:
                '201':
                    description: API key secret rotated. Returns new token.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  api_key:
                                                      $ref: '#/components/schemas/ApiKey'
                                                  token:
                                                      type: string
    /api/admin/api-keys/{keyId}/toggle:
        post:
            tags:
                - Admin
            summary: Toggle API key activation
            operationId: adminToggleApiKey
            parameters:
                - name: keyId
                  in: path
                  required: true
                  schema:
                      type: integer
            responses:
                '200':
                    description: API key status toggled.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/api-keys/{keyId}:
        delete:
            tags:
                - Admin
            summary: Delete API key
            operationId: adminDeleteApiKey
            parameters:
                - name: keyId
                  in: path
                  required: true
                  schema:
                      type: integer
            responses:
                '200':
                    description: API key deleted.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/rate-limits:
        get:
            tags:
                - Admin
            summary: List rate limit rules
            operationId: adminListRateLimits
            parameters:
                - name: company_id
                  in: query
                  schema:
                      type: integer
                - $ref: '#/components/parameters/PageQuery'
                - $ref: '#/components/parameters/PerPageQuery'
            responses:
                '200':
                    description: Paginated rate limit definitions.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              type: object
                                              properties:
                                                  items:
                                                      type: array
                                                      items:
                                                          $ref: '#/components/schemas/RateLimitRule'
                                                  meta:
                                                      $ref: '#/components/schemas/PageMeta'
        post:
            tags:
                - Admin
            summary: Create rate limit rule
            operationId: adminCreateRateLimit
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - scope
                                - window_seconds
                                - max_requests
                            properties:
                                company_id:
                                    type: integer
                                    nullable: true
                                scope:
                                    type: string
                                window_seconds:
                                    type: integer
                                max_requests:
                                    type: integer
                                active:
                                    type: boolean
            responses:
                '201':
                    description: Rate limit created.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
    /api/admin/rate-limits/{rateLimitId}:
        parameters:
            - name: rateLimitId
              in: path
              required: true
              schema:
                  type: integer
        get:
            tags:
                - Admin
            summary: Show rate limit rule
            operationId: adminShowRateLimit
            responses:
                '200':
                    description: Rate limit rule detail.
                    content:
                        application/json:
                            schema:
                                allOf:
                                    - $ref: '#/components/schemas/ApiSuccessResponse'
                                    - type: object
                                      properties:
                                          data:
                                              $ref: '#/components/schemas/RateLimitRule'
        put:
            tags:
                - Admin
            summary: Update rate limit rule
            operationId: adminUpdateRateLimit
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                window_seconds:
                                    type: integer
                                max_requests:
                                    type: integer
                                active:
                                    type: boolean
            responses:
                '200':
                    description: Rate limit updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
        delete:
            tags:
                - Admin
            summary: Delete rate limit rule
            operationId: adminDeleteRateLimit
            responses:
                '200':
                    description: Rate limit removed.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ApiSuccessResponse'
