components:
  schemas:
    GoodsReceiptNote:
      type: object
      required:
        - id
        - purchase_order_id
        - number
        - status
      properties:
        id:
          type: string
          format: uuid
        company_id:
          type: integer
        purchase_order_id:
          type: integer
        number:
          type: string
        status:
          type: string
          enum: [draft, inspecting, accepted, rejected]
        inspected_by_id:
          type: integer
          nullable: true
        inspected_at:
          type: string
          format: date-time
          nullable: true
        inspector:
          type: object
          nullable: true
          properties:
            id:
              type: integer
            name:
              type: string
        lines:
          type: array
          items:
            $ref: '#/components/schemas/GoodsReceiptLine'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    GoodsReceiptLine:
      type: object
      required:
        - id
        - purchase_order_line_id
        - quantity_received
      properties:
        id:
          type: string
          format: uuid
        purchase_order_line_id:
          type: string
          format: uuid
        quantity_received:
          type: number
        quantity_accepted:
          type: number
          nullable: true
        quantity_rejected:
          type: number
          nullable: true
        rejection_reason:
          type: string
          nullable: true
        attachments:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              filename:
                type: string
              mime:
                type: string
              size_bytes:
                type: integer
    Rma:
      type: object
      required:
        - id
        - status
        - purchase_order_id
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          enum: [draft, submitted, reviewing, approved, rejected, closed]
        purchase_order_id:
          type: integer
        reason:
          type: string
        resolution:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
paths:
  /api/purchase-orders/{purchaseOrderId}/grns:
    parameters:
      - name: purchaseOrderId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - Inventory
      summary: List goods receipt notes for purchase order
      operationId: listGrns
      responses:
        '200':
          description: Collection of goods receipt notes.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        required:
                          - items
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/GoodsReceiptNote'
                          meta:
                            $ref: '#/components/schemas/PageMeta'
    post:
      tags:
        - Inventory
      summary: Create goods receipt note
      operationId: createGrn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - lines
              properties:
                lines:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - purchase_order_line_id
                      - quantity_received
                    properties:
                      purchase_order_line_id:
                        type: string
                        format: uuid
                      quantity_received:
                        type: number
                      quantity_accepted:
                        type: number
                        nullable: true
                      quantity_rejected:
                        type: number
                        nullable: true
                      rejection_reason:
                        type: string
                        nullable: true
                inspected_at:
                  type: string
                  format: date-time
                  nullable: true
      responses:
        '201':
          description: Goods receipt note created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/purchase-orders/{purchaseOrderId}/grns/{grnId}:
    parameters:
      - name: purchaseOrderId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: grnId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - Inventory
      summary: Show goods receipt note
      operationId: showGrn
      responses:
        '200':
          description: Goods receipt details.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GoodsReceiptNote'
    put:
      tags:
        - Inventory
      summary: Update goods receipt note
      operationId: updateGrn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [draft, inspecting, accepted, rejected]
                lines:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      quantity_accepted:
                        type: number
                      quantity_rejected:
                        type: number
                      rejection_reason:
                        type: string
                        nullable: true
      responses:
        '200':
          description: Goods receipt updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
    delete:
      tags:
        - Inventory
      summary: Delete goods receipt note
      operationId: deleteGrn
      responses:
        '200':
          description: Goods receipt deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/rmas:
    get:
      tags:
        - Inventory
      summary: List RMAs
      operationId: listRmas
      responses:
        '200':
          description: Collection of RMAs.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        required:
                          - items
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/Rma'
                          meta:
                            $ref: '#/components/schemas/PageMeta'
  /api/rmas/purchase-orders/{purchaseOrderId}:
    post:
      tags:
        - Inventory
      summary: Create RMA for purchase order
      operationId: createRma
      parameters:
        - name: purchaseOrderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                attachments:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        '201':
          description: RMA created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/rmas/{rmaId}:
    get:
      tags:
        - Inventory
      summary: Retrieve RMA
      operationId: showRma
      parameters:
        - name: rmaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: RMA detail.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Rma'
  /api/rmas/{rmaId}/review:
    post:
      tags:
        - Inventory
      summary: Review RMA
      operationId: reviewRma
      parameters:
        - name: rmaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - decision
              properties:
                decision:
                  type: string
                  enum: [approve, reject]
                comment:
                  type: string
                  nullable: true
      responses:
        '200':
          description: Review recorded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
