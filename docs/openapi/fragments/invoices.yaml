components:
  schemas:
    Invoice:
      type: object
      required:
        - id
        - company_id
        - purchase_order_id
        - invoice_number
        - status
        - currency
        - total
      properties:
        id:
          type: string
          format: uuid
        company_id:
          type: integer
        purchase_order_id:
          type: integer
        supplier_id:
          type: integer
          nullable: true
        invoice_number:
          type: string
        currency:
          type: string
        status:
          type: string
          enum: [draft, submitted, approved, rejected, paid]
        subtotal:
          type: number
          format: float
        tax_amount:
          type: number
          format: float
        total:
          type: number
          format: float
        match_summary:
          type: object
          properties:
            matched:
              type: integer
            qty_mismatch:
              type: integer
            price_mismatch:
              type: integer
            unmatched:
              type: integer
        document:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            filename:
              type: string
            mime:
              type: string
            size_bytes:
              type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    InvoiceCollection:
      type: object
      required:
        - items
        - meta
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Invoice'
        meta:
          $ref: '#/components/schemas/PageMeta'
paths:
  /api/purchase-orders/{purchaseOrderId}/invoices:
    parameters:
      - name: purchaseOrderId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - Invoices
      summary: List invoices for a purchase order
      operationId: listInvoicesForPurchaseOrder
      responses:
        '200':
          description: Paginated invoices linked to the purchase order.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/InvoiceCollection'
    post:
      tags:
        - Invoices
      summary: Create invoice for purchase order
      operationId: createInvoiceForPurchaseOrder
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - invoice_number
                - currency
                - total
                - file
              properties:
                invoice_number:
                  type: string
                currency:
                  type: string
                subtotal:
                  type: number
                  format: float
                tax_amount:
                  type: number
                  format: float
                total:
                  type: number
                  format: float
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Invoice captured.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Invoice'
  /api/invoices/{invoiceId}:
    parameters:
      - name: invoiceId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - Invoices
      summary: Retrieve invoice
      operationId: showInvoice
      responses:
        '200':
          description: Invoice details.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Invoice'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - Invoices
      summary: Update invoice metadata
      operationId: updateInvoice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                invoice_number:
                  type: string
                status:
                  type: string
                subtotal:
                  type: number
                  format: float
                tax_amount:
                  type: number
                  format: float
                total:
                  type: number
                  format: float
      responses:
        '200':
          description: Invoice updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
    delete:
      tags:
        - Invoices
      summary: Delete invoice
      operationId: deleteInvoice
      responses:
        '200':
          description: Invoice deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/invoices/{invoiceId}/recalculate:
    post:
      tags:
        - Invoices
      summary: Recalculate invoice totals
      operationId: recalculateInvoice
      parameters:
        - name: invoiceId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Recalculated invoice summary.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
