components:
  schemas:
    Quote:
      type: object
      required:
        - id
        - rfq_id
        - supplier_id
        - status
        - currency
        - total_minor
      properties:
        id:
          type: string
          format: uuid
        rfq_id:
          type: string
          format: uuid
        supplier_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [draft, submitted, awarded, withdrawn, expired]
        currency:
          type: string
        unit_price:
          type: number
          format: float
        subtotal:
          type: string
        subtotal_minor:
          type: integer
        tax_amount:
          type: string
        tax_amount_minor:
          type: integer
        total:
          type: string
        total_minor:
          type: integer
        min_order_qty:
          type: integer
          nullable: true
        lead_time_days:
          type: integer
          nullable: true
        note:
          type: string
          nullable: true
        revision_no:
          type: integer
        submitted_by:
          type: integer
          nullable: true
        submitted_at:
          type: string
          format: date-time
          nullable: true
        withdrawn_at:
          type: string
          format: date-time
          nullable: true
        withdraw_reason:
          type: string
          nullable: true
        supplier:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/QuoteItem'
        attachments:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              filename:
                type: string
              path:
                type: string
              mime:
                type: string
              size_bytes:
                type: integer
        revisions:
          type: array
          items:
            $ref: '#/components/schemas/QuoteRevision'
    QuoteItem:
      type: object
      required:
        - id
        - quote_id
        - rfq_item_id
        - quantity
        - unit_price_minor
      properties:
        id:
          type: string
          format: uuid
        quote_id:
          type: string
          format: uuid
        rfq_item_id:
          type: string
          format: uuid
        description:
          type: string
          nullable: true
        quantity:
          type: integer
        uom:
          type: string
        unit_price:
          type: string
        unit_price_minor:
          type: integer
        line_total:
          type: string
        line_total_minor:
          type: integer
    QuoteRevision:
      type: object
      required:
        - id
        - quote_id
        - revision_no
        - status
      properties:
        id:
          type: string
          format: uuid
        quote_id:
          type: string
          format: uuid
        revision_no:
          type: integer
        status:
          type: string
        submitted_at:
          type: string
          format: date-time
          nullable: true
        note:
          type: string
          nullable: true
paths:
  /api/rfqs/{rfqId}/quotes:
    parameters:
      - name: rfqId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - Quotes
      summary: List quotes for RFQ
      operationId: listQuotesForRfq
      responses:
        '200':
          description: Quotes submitted for the RFQ.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        required:
                          - items
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/Quote'
  /api/quotes:
    post:
      tags:
        - Quotes
      summary: Submit quote directly
      operationId: submitQuote
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rfq_id
                - currency
                - items
              properties:
                rfq_id:
                  type: string
                  format: uuid
                supplier_id:
                  type: string
                  format: uuid
                currency:
                  type: string
                lead_time_days:
                  type: integer
                  nullable: true
                min_order_qty:
                  type: integer
                  nullable: true
                note:
                  type: string
                  nullable: true
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - rfq_item_id
                      - unit_price_minor
                      - quantity
                    properties:
                      rfq_item_id:
                        type: string
                        format: uuid
                      quantity:
                        type: integer
                      unit_price_minor:
                        type: integer
                attachments:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        '201':
          description: Quote submitted.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Quote'
        '422':
          $ref: '#/components/responses/ValidationError'
  /api/rfqs/{rfqId}/quotes/{quoteId}/revisions:
    parameters:
      - name: rfqId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: quoteId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - Quotes
      summary: List quote revisions
      operationId: listQuoteRevisions
      responses:
        '200':
          description: Quote revision history.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        required:
                          - items
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/QuoteRevision'
    post:
      tags:
        - Quotes
      summary: Submit quote revision
      operationId: submitQuoteRevision
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - note
                - items
              properties:
                note:
                  type: string
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - rfq_item_id
                      - unit_price_minor
                      - quantity
                    properties:
                      rfq_item_id:
                        type: string
                        format: uuid
                      quantity:
                        type: integer
                      unit_price_minor:
                        type: integer
      responses:
        '201':
          description: Revision accepted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/rfqs/{rfqId}/quotes/{quoteId}/withdraw:
    post:
      tags:
        - Quotes
      summary: Withdraw quote
      operationId: withdrawQuote
      parameters:
        - name: rfqId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: quoteId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Quote withdrawn.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
