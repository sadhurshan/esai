components:
  schemas:
    Supplier:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
        company_id:
          type: integer
        name:
          type: string
        status:
          type: string
          description: Supplier onboarding status.
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    SupplierApplication:
      type: object
      required:
        - id
        - supplier_name
        - status
      properties:
        id:
          type: integer
        supplier_name:
          type: string
        status:
          type: string
        submitted_at:
          type: string
          format: date-time
          nullable: true
    SupplierApplicationPayload:
      type: object
      required:
        - capabilities
      properties:
        capabilities:
          type: object
          additionalProperties: false
          properties:
            methods:
              type: array
              items:
                type: string
                maxLength: 160
            materials:
              type: array
              items:
                type: string
                maxLength: 160
            tolerances:
              type: array
              items:
                type: string
                maxLength: 120
            finishes:
              type: array
              items:
                type: string
                maxLength: 160
            industries:
              type: array
              items:
                type: string
                maxLength: 160
        description:
          type: string
          maxLength: 500
          nullable: true
        address:
          type: string
          maxLength: 191
          nullable: true
        country:
          type: string
          minLength: 2
          maxLength: 2
          nullable: true
        city:
          type: string
          maxLength: 160
          nullable: true
        moq:
          type: integer
          minimum: 1
          nullable: true
        min_order_qty:
          type: integer
          minimum: 1
          nullable: true
        lead_time_days:
          type: integer
          minimum: 1
          nullable: true
        geo:
          type: object
          nullable: true
          properties:
            lat:
              type: number
              format: double
            lng:
              type: number
              format: double
        certifications:
          type: array
          items:
            type: string
            maxLength: 160
          nullable: true
        facilities:
          type: string
          maxLength: 500
          nullable: true
        website:
          type: string
          format: uri
          maxLength: 191
          nullable: true
        contact:
          type: object
          nullable: true
          properties:
            name:
              type: string
              maxLength: 160
            email:
              type: string
              format: email
              maxLength: 191
            phone:
              type: string
              maxLength: 60
        notes:
          type: string
          maxLength: 255
          nullable: true
        documents:
          type: array
          items:
            type: integer
          nullable: true
      additionalProperties: false
    SupplierDocument:
      type: object
      required:
        - id
        - type
        - status
        - filename
      properties:
        id:
          type: integer
        supplier_id:
          type: integer
          nullable: true
        company_id:
          type: integer
        document_id:
          type: integer
          nullable: true
        type:
          type: string
          description: Document classification (iso9001, nda, other, etc.).
        status:
          type: string
        path:
          type: string
          nullable: true
        download_url:
          type: string
          format: uri
          nullable: true
        mime:
          type: string
          nullable: true
        filename:
          type: string
        size_bytes:
          type: integer
        issued_at:
          type: string
          format: date
          nullable: true
        expires_at:
          type: string
          format: date
          nullable: true
        created_at:
          type: string
          format: date-time
          nullable: true
        updated_at:
          type: string
          format: date-time
          nullable: true
paths:
  /api/suppliers:
    get:
      tags:
        - Suppliers
      summary: List suppliers for current company
      operationId: listSuppliers
      responses:
        '200':
          description: Paginated suppliers.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/Supplier'
  /api/suppliers/{supplierId}:
    parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
    get:
      tags:
        - Suppliers
      summary: Show supplier
      operationId: showSupplier
      responses:
        '200':
          description: Supplier details.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Supplier'
  /api/suppliers/{supplierId}/esg:
    parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
    get:
      tags:
        - Suppliers
      summary: List ESG records for supplier
      operationId: listSupplierEsg
      responses:
        '200':
          description: Environmental, social, and governance records for the supplier.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
    post:
      tags:
        - Suppliers
      summary: Store ESG record for supplier
      operationId: createSupplierEsg
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '201':
          description: ESG record created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/suppliers/{supplierId}/esg/export:
    parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
    post:
      tags:
        - Suppliers
      summary: Queue ESG export for supplier
      operationId: exportSupplierEsg
      responses:
        '202':
          description: ESG export queued.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/suppliers/{supplierId}/esg/{recordId}:
    parameters:
      - name: supplierId
        in: path
        required: true
        schema:
          type: integer
      - name: recordId
        in: path
        required: true
        schema:
          type: integer
    put:
      tags:
        - Suppliers
      summary: Update ESG record
      operationId: updateSupplierEsg
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: ESG record updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
    delete:
      tags:
        - Suppliers
      summary: Delete ESG record
      operationId: deleteSupplierEsg
      responses:
        '200':
          description: ESG record deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/supplier-applications:
    get:
      tags:
        - Suppliers
      summary: List supplier applications
      operationId: listSupplierApplications
      responses:
        '200':
          description: Paginated supplier applications.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/SupplierApplication'
    post:
      tags:
        - Suppliers
      summary: Submit supplier application
      operationId: createSupplierApplication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SupplierApplicationPayload'
      responses:
        '200':
          description: Supplier application submitted.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SupplierApplication'
  /api/supplier-applications/{applicationId}:
    parameters:
      - name: applicationId
        in: path
        required: true
        schema:
          type: integer
    get:
      tags:
        - Suppliers
      summary: Show supplier application
      operationId: showSupplierApplication
      responses:
        '200':
          description: Supplier application details.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SupplierApplication'
    delete:
      tags:
        - Suppliers
      summary: Delete supplier application
      operationId: deleteSupplierApplication
      responses:
        '200':
          description: Supplier application deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/me/supplier-application/status:
    get:
      tags:
        - Suppliers
      summary: Get supplier self-service application status
      operationId: showSelfServiceSupplierApplicationStatus
      responses:
        '200':
          description: Current status for the authenticated user's company application.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/me/apply-supplier:
    post:
      tags:
        - Suppliers
      summary: Submit a supplier application for the authenticated company
      description: Allows the current company owner to self-apply to the supplier directory using the same payload as internal submissions.
      operationId: selfApplySupplierApplication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SupplierApplicationPayload'
      responses:
        '200':
          description: Supplier application submitted for review.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SupplierApplication'
        '403':
          description: Missing permissions or company context.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '422':
          description: Payload failed validation or a pending application already exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
  /api/me/supplier/visibility:
    put:
      tags:
        - Suppliers
      summary: Update supplier directory visibility
      operationId: updateSupplierVisibility
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: Visibility updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
  /api/me/supplier-documents:
    get:
      tags:
        - Suppliers
      summary: List compliance documents uploaded by the authenticated company
      operationId: listSupplierDocuments
      responses:
        '200':
          description: Supplier documents collection.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/SupplierDocument'
    post:
      tags:
        - Suppliers
      summary: Upload a new compliance document for the authenticated company
      operationId: createSupplierDocument
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - type
                - document
              properties:
                type:
                  type: string
                  description: Document type code (iso9001, iso14001, as9100, itar, reach, rohs, insurance, nda, other).
                document:
                  type: string
                  format: binary
                issued_at:
                  type: string
                  format: date
                  nullable: true
                expires_at:
                  type: string
                  format: date
                  nullable: true
      responses:
        '200':
          description: Supplier document stored.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiSuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SupplierDocument'
  /api/me/supplier-documents/{document}:
    parameters:
      - name: document
        in: path
        required: true
        schema:
          type: integer
    delete:
      tags:
        - Suppliers
      summary: Delete a supplier compliance document
      operationId: deleteSupplierDocument
      responses:
        '200':
          description: Supplier document deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiSuccessResponse'
