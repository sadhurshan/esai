openapi: 3.1.0
info:
  title: Elements Supply API
  version: "2025.11.0"
  summary: Canonical contract for the Elements Supply public API.
  description: |
    Elements Supply is a multi-tenant sourcing and procurement platform that exposes a single
    public API for authenticated buyers, suppliers, and platform administrators. All responses
    are wrapped in the standard envelope documented in `/docs/API_ENVELOPE.md` and conform to
    the schemas defined in this spec. Unless noted otherwise, every path requires either a
    bearer token (Sanctum personal access token) or an API key issued by the platform admin
    console.
  contact:
    name: Elements Supply Team
    url: https://elements-supply.ai
    email: support@elements-supply.ai
servers:
  - url: https://api.elements-supply.ai
    description: Production API endpoint
  - url: https://{tenant}.elements-supply.ai
    description: Tenant-scoped production endpoint
    variables:
      tenant:
        description: Subdomain slug for the tenant (e.g. `acme`)
        default: app
  - url: http://localhost/api
    description: Local development
externalDocs:
  description: Full product requirements
  url: https://github.com/sadhurshan/elements-supply-ai/docs/REQUIREMENTS_FULL.md
tags:
  - name: Health
    description: Readiness and diagnostic endpoints
  - name: Auth
    description: Authentication session management and API key usage
  - name: RFQs
    description: Manage requests for quotation and related supplier interactions
  - name: RFPs
    description: Project RFP authoring, publishing, and proposal workflows
  - name: Quotes
    description: Quote submission, revision, and award workflows
  - name: Purchase Orders
    description: Purchase order lifecycle, change orders, and totals
  - name: Orders
    description: Supplier-facing order visibility endpoints
  - name: Invoices
    description: Invoicing, credit notes, and financial reconciliation
  - name: Inventory
    description: Goods receipt, issues, and warehouse movements
  - name: Exports
    description: Bulk data export creation and download
  - name: Downloads
    description: On-demand PDF or CSV document downloads queued from the workspace
  - name: CRM
    description: Customer relationship data exports and insights
  - name: Suppliers
    description: Supplier directory, segments, and applications
  - name: Notifications
    description: In-app notification feeds and read state management
  - name: Risk
    description: Supplier risk scoring and refresh workflows
  - name: Digital Twin
    description: Asset telemetry, synchronization, and work orders
  - name: Analytics
    description: Self-serve analytics reports and scheduled runs
  - name: Copilot
    description: AI-assisted workflows and prompt catalogues
  - name: Documents
    description: File uploads and document staging APIs
  - name: Settings
    description: Tenant-level configuration (company profile, localization, numbering)
  - name: Localization
    description: Localization settings, units of measure, and conversions
  - name: Money
    description: Monetary settings, FX rates, and tax configuration
  - name: Billing
    description: Subscription management, billing portal access, and plan checkout flows
  - name: Approvals
    description: Purchase order approval rules, requests, and delegations
  - name: Admin
    description: Platform administration (plans, health, read-only reference data)
  - name: Webhooks
    description: Outbound webhook subscription formats and delivery expectations
x-fragments:
  description: Ordered list of YAML fragments that are merged into the root spec when built.
  order:
    - auth.yaml
    - companies_plans.yaml
    - invitations.yaml
    - suppliers.yaml
    - crm.yaml
    - rfqs.yaml
    - rfps.yaml
    - quotes.yaml
    - purchase_orders.yaml
    - orders.yaml
    - invoices.yaml
    - credit_notes.yaml
    - inventory.yaml
    - exports.yaml
    - downloads.yaml
    - analytics.yaml
    - risk.yaml
    - digital_twin.yaml
    - notifications.yaml
    - copilot.yaml
    - files.yaml
    - settings.yaml
    - localization.yaml
    - money_tax.yaml
    - approvals.yaml
    - admin.yaml
    - webhooks.yaml
    - search.yaml
security:
  - bearerAuth: []
  - apiKeyAuth: []
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Supply a bearer token acquired via Sanctum. All tokens are scoped to a specific
        company tenant and inherit the permissions assigned to the issuing user.
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        API keys are issued and rotated in the platform admin console. Include the value in the
        `X-API-Key` header to authenticate machine-to-machine integrations.
  parameters:
    XRequestId:
      name: X-Request-Id
      in: header
      required: false
      description: Correlates requests across services. Echoed back on every response when supplied.
      schema:
        type: string
    AcceptLanguage:
      name: Accept-Language
      in: header
      required: false
      description: Overrides language resolution when localization features are enabled.
      schema:
        type: string
    CursorQuery:
      name: cursor
      in: query
      required: false
      description: Cursor token for pagination.
      schema:
        type: string
    PageQuery:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
    PerPageQuery:
      name: per_page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
  headers:
    XRequestId:
      description: Unique identifier for the current request.
      schema:
        type: string
    XRateLimitLimit:
      description: Maximum number of requests allowed in the current window.
      schema:
        type: integer
    XRateLimitRemaining:
      description: Remaining requests available in the current window.
      schema:
        type: integer
    XRateLimitReset:
      description: Seconds until the current rate limit window resets.
      schema:
        type: integer
    XTraceId:
      description: Internal trace identifier for support escalations.
      schema:
        type: string
  schemas:
    SuccessEnvelope:
      type: object
      required:
        - status
        - data
      properties:
        status:
          type: string
          enum: [success]
        message:
          type: string
          nullable: true
        data:
          description: Module-specific payload.
        meta:
          $ref: '#/components/schemas/RequestMeta'
      additionalProperties: false
      description: Wrapper for all successful responses. `meta.request_id` always echoes the inbound `X-Request-Id` or an internally generated UUID.
    ErrorEnvelope:
      type: object
      required:
        - status
        - message
      properties:
        status:
          type: string
          enum: [error]
        message:
          type: string
        code:
          type: string
          nullable: true
        errors:
          type: object
          description: Field-level validation errors keyed by attribute.
          additionalProperties:
            type: array
            items:
              type: string
        data:
          nullable: true
          description: Always null for error responses.
      additionalProperties: false
    ApiSuccessResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessEnvelope'
    ApiErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ErrorEnvelope'
    RequestMeta:
      type: object
      description: Metadata applied to every successful response. Includes request correlation identifiers and pagination cursors.
      required:
        - request_id
      properties:
        request_id:
          type: string
          description: UUID assigned to the request (matches `X-Request-Id`).
        pagination:
          $ref: '#/components/schemas/PageMeta'
        cursor:
          $ref: '#/components/schemas/CursorMeta'
      additionalProperties: false
    EnvelopeMeta:
      allOf:
        - $ref: '#/components/schemas/RequestMeta'
      description: Legacy alias for response metadata. # TODO: clarify if consumers should migrate to RequestMeta directly.
    PageMeta:
      type: object
      description: Page/offset pagination metadata.
      required:
        - current_page
        - per_page
        - total
        - last_page
      properties:
        total:
          type: integer
          minimum: 0
        per_page:
          type: integer
          minimum: 1
        current_page:
          type: integer
          minimum: 1
        last_page:
          type: integer
          minimum: 1
        page:
          type: integer
          minimum: 1
          readOnly: true
          description: Alias provided for SDK ergonomics. Mirrors `current_page`.
    CursorMeta:
      type: object
      description: Pagination metadata for cursor endpoints.
      required:
        - next_cursor
      properties:
        next_cursor:
          type: string
          nullable: true
        prev_cursor:
          type: string
          nullable: true
        has_next:
          type: boolean
        has_prev:
          type: boolean
    Money:
      type: object
      description: Monetary amount expressed in minor units. `amount` is derived from `amount_minor` and `currency` using the company rounding rules.
      required:
        - amount_minor
        - currency
        - amount
      properties:
        amount_minor:
          type: integer
        currency:
          type: string
          minLength: 3
          maxLength: 3
        amount:
          type: number
          format: float
          description: Derived major-unit representation. Submitters may omit; backend recalculates using company precision.
    Timeline:
      type: object
      properties:
        created_at:
          type: string
          format: date-time
          description: ISO 8601 timestamp in the tenant's configured timezone.
        updated_at:
          type: string
          format: date-time
          description: ISO 8601 timestamp in the tenant's configured timezone.
        deleted_at:
          type: string
          format: date-time
          nullable: true
          description: ISO 8601 timestamp in the tenant's configured timezone.
    CopilotSearchFilters:
      type: object
      description: Optional filters applied to copilot search and answer endpoints.
      properties:
        source_type:
          type: string
          maxLength: 100
        doc_id:
          type: string
          description: Document identifier as a string to match the AI index payloads.
        doc_version:
          type: string
          maxLength: 100
        tags:
          type: array
          items:
            type: string
            maxLength: 100
          description: Arbitrary metadata tags stored with the document index.
    CopilotQueryRequest:
      type: object
      description: Query payload accepted by copilot semantic search and answer endpoints.
      required:
        - query
      properties:
        query:
          type: string
          maxLength: 2000
        top_k:
          type: integer
          minimum: 1
          maximum: 20
          description: Overrides the default number of chunks returned by the AI service.
        filters:
          $ref: '#/components/schemas/CopilotSearchFilters'
    CopilotSearchHit:
      type: object
      description: Ranked chunk metadata returned from the semantic search endpoint.
      required:
        - doc_id
        - doc_version
        - chunk_id
        - score
        - snippet
      properties:
        doc_id:
          type: string
        doc_version:
          type: string
        chunk_id:
          type: string
        title:
          type: string
        snippet:
          type: string
          description: Preview text trimmed to the first 250 characters.
        score:
          type: number
          format: float
        metadata:
          type: object
          additionalProperties: true
          description: Arbitrary metadata captured when the chunk was indexed.
    CopilotSearchResult:
      type: object
      required:
        - hits
      properties:
        hits:
          type: array
          items:
            $ref: '#/components/schemas/CopilotSearchHit'
          description: Ordered by cosine similarity.
    CopilotCitation:
      type: object
      required:
        - doc_id
        - doc_version
        - chunk_id
        - snippet
        - score
      properties:
        doc_id:
          type: string
        doc_version:
          type: string
        chunk_id:
          type: string
        score:
          type: number
          format: float
        snippet:
          type: string
    CopilotAnswerResult:
      type: object
      required:
        - answer
        - citations
      properties:
        answer:
          type: string
          description: Structured natural language response assembled from the top chunks.
        citations:
          type: array
          items:
            $ref: '#/components/schemas/CopilotCitation'
          description: Source mapping each bullet point back to a document chunk.
    CopilotActionPlanRequest:
      type: object
      required:
        - action_type
        - query
      properties:
        action_type:
          type: string
          description: Type of Copilot action to execute.
          enum:
            - rfq_draft
            - supplier_message
            - maintenance_checklist
            - inventory_whatif
        query:
          type: string
          maxLength: 2000
          description: Natural language instruction provided to Copilot.
        inputs:
          type: object
          description: Structured key/value pairs used to seed the draft payload.
          additionalProperties: true
        user_context:
          type: object
          description: Supplemental context about the acting user and company.
          additionalProperties: true
        top_k:
          type: integer
          minimum: 1
          maximum: 25
          default: 8
          description: Number of semantic search chunks retrieved upstream.
        filters:
          type: object
          description: Optional semantic search filters.
          properties:
            source_type:
              type: string
              maxLength: 128
            doc_id:
              type: string
              maxLength: 255
            tags:
              type: array
              items:
                type: string
                maxLength: 64
        entity_type:
          type: string
          maxLength: 64
          nullable: true
          description: Domain entity the draft references (e.g. `rfq`).
        entity_id:
          type: integer
          minimum: 1
          nullable: true
          description: Identifier of the referenced entity when present.
    CopilotActionRejectRequest:
      type: object
      required:
        - reason
      properties:
        reason:
          type: string
          maxLength: 1000
          description: Human-readable explanation of why the draft was rejected.
    CopilotActionFeedbackRequest:
      type: object
      required:
        - rating
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating on a five-point scale describing draft quality.
        comment:
          type: string
          maxLength: 2000
          nullable: true
          description: Optional free-form feedback for the AI team.
    CopilotActionDraft:
      type: object
      properties:
        id:
          type: integer
        action_type:
          type: string
          enum:
            - rfq_draft
            - supplier_message
            - maintenance_checklist
            - inventory_whatif
        status:
          type: string
          enum:
            - drafted
            - approved
            - rejected
            - expired
        summary:
          type: string
          nullable: true
        payload:
          type: object
          additionalProperties: true
          description: Structured payload Copilot proposes applying to the workspace.
        citations:
          type: array
          items:
            $ref: '#/components/schemas/CopilotCitation'
        confidence:
          type: number
          format: float
          nullable: true
        needs_human_review:
          type: boolean
        warnings:
          type: array
          items:
            type: object
            additionalProperties: true
        output:
          type: object
          additionalProperties: true
          description: Raw Copilot response for auditing and debugging.
        entity_type:
          type: string
          nullable: true
        entity_id:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CopilotActionFeedback:
      type: object
      properties:
        id:
          type: integer
        ai_action_draft_id:
          type: integer
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string
          nullable: true
        user_id:
          type: integer
        created_at:
          type: string
          format: date-time
    AiDocumentReindexRequest:
      type: object
      description: Payload required to queue an AI reindex for a document.
      required:
        - doc_id
        - doc_version
      properties:
        doc_id:
          type: integer
          minimum: 1
        doc_version:
          type: string
          maxLength: 100
    AiDocumentReindexStatus:
      type: object
      description: Echo payload describing the queued reindex operation.
      required:
        - doc_id
        - doc_version
      properties:
        doc_id:
          type: integer
          minimum: 1
        doc_version:
          type: string
          maxLength: 100
  responses:
    Unauthorized:
      description: Missing or invalid credentials.
      headers:
        X-Request-Id:
          $ref: '#/components/headers/XRequestId'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
          example:
            status: error
            message: Unauthorized.
            data: null
    Forbidden:
      description: Authenticated but lacking required permissions.
      headers:
        X-Request-Id:
          $ref: '#/components/headers/XRequestId'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
          example:
            status: error
            message: Forbidden.
            data: null
    NotFound:
      description: Resource not found.
      headers:
        X-Request-Id:
          $ref: '#/components/headers/XRequestId'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
          example:
            status: error
            message: Not found
            data: null
    ValidationError:
      description: Payload validation failed.
      headers:
        X-Request-Id:
          $ref: '#/components/headers/XRequestId'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
          example:
            status: error
            message: The given data was invalid.
            errors:
              item_name:
                - The item name field is required.
            data: null
    TooManyRequests:
      description: Rate limit exceeded for the current identity.
      headers:
        X-Request-Id:
          $ref: '#/components/headers/XRequestId'
        X-RateLimit-Limit:
          $ref: '#/components/headers/XRateLimitLimit'
        X-RateLimit-Remaining:
          $ref: '#/components/headers/XRateLimitRemaining'
        X-RateLimit-Reset:
          $ref: '#/components/headers/XRateLimitReset'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
          example:
            status: error
            message: Request limit exceeded, retry later.
            code: RATE_LIMIT_EXCEEDED
            data: null
    ServerError:
      description: Unexpected server error. Contact support with the supplied request identifier.
      headers:
        X-Request-Id:
          $ref: '#/components/headers/XRequestId'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
          example:
            status: error
            message: Unexpected error occurred.
            data: null
paths: {}
